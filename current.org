#+TITLE: Promos
:ticket: https://trello.com/c/KcXfoTmR


* Failing specs

#+begin_src sh
rspec ./spec/controllers/admin/promotions_controller_spec.rb:90 # Admin::PromotionsController DELETE #destroy removes a promotion
rspec ./spec/services/build_promo_codes_spec.rb:7 # BuildPromoCodes#perform creates one promo
rspec ./spec/services/build_promo_codes_spec.rb:13 # BuildPromoCodes#perform argument is passed creates the number of promos
rspec ./spec/services/build_promo_codes_spec.rb:21 # BuildPromoCodes#random_code creates a random code
#+end_src


** promotions controller

*** relation delgate class error


#+begin_src zsh :session *shell*
be rspec ./spec/controllers/admin/promotions_controller_spec.rb:90 # Admin::PromotionsController DELETE #destroy removes a promotion

#>>     NoMethodError:
#>>       undefined method `relation_delegate_class' for PromotionCode:Class

#+end_src

**** solution
:commit: fe38f
Needed to add correct relation


*** model not initalized

#+begin_src ruby :session strangler-console :output results
a = PromotionCode.new( code: SecureRandom.hex(3), use_limit: 1)
#+end_src

#+RESULTS:
: #<PromotionCode id: nil, promotion_id: nil, code: "93b091", use_limit: 1, uses: nil, created_at: nil, updated_at: nil>

- Looks like the code was changed class
  - Yep, changed the PromotionCode  commit 8d748c
